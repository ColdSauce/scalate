<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="description" content="scala template engine implementing HAML, JSP, Erb style templates">
    <meta name="keywords" content="scalate,scala,template engine,haml,erb,jsp">
    <meta name="author" content="Scalate">

    <link href="../styles/impact/css/pygmentize.css" rel="stylesheet" type="text/css">
    <link href="../styles/impact/css/site.css" rel="stylesheet" type="text/css">
    
    <title>Scalate Embedding Guide</title>



</head>
<body>
  
  <div id="navigation">
  	<div class="wrapper">
      <ul><li class="webgen-menu-level1"><a href="../index.html">Scalate 1.1</a></li><li class="webgen-menu-level1"><a href="../download.html">Download</a></li><li class="webgen-menu-level1"><a href="../source.html">Source</a></li><li class="webgen-menu-level1"><a href="../community.html">Community</a></li><li class="webgen-menu-level1"><a href="../support.html">Support</a></li><li class="webgen-menu-level1 webgen-menu-submenu webgen-menu-submenu-inhierarchy"><a href="index.html">Documentation</a></li></ul>
  	</div>
  </div>
  

  <div id="overview">
    <div class="wrapper">
      
      <div class="logo">
        <img alt="scalate logo" src="../images/project-logo.png">
      </div>
      
      <div class="message">
        <h1 id='scalate_embedding_guide'>Scalate Embedding Guide</h1>

<p>Embeddable? Check.</p>
      </div>
    </div>
  </div>





  <div id='content'>
  	<div class='wrapper'>
      <h1 id='scalate_embedding_guide'>Scalate Embedding Guide</h1>
<div class='maruku_toc'><ul style='list-style: none;'><li><a href='#creating_the_template_engine'>Creating the Template Engine</a></li><li><a href='#passing_data_to_the_template'>Passing Data to the Template</a></li><li><a href='#passing_data_from_the_template_elsewhere'>Passing Data from the Template elsewhere</a></li><li><a href='#implicitly_bound_variables'>Implicitly Bound Variables</a><ul style='list-style: none;'><li><a href='#implicitly_imported_bound_variables'>Implicitly Imported Bound Variables</a></li></ul></li><li><a href='#configuring_the_'>Configuring the <code>TemplateEngine</code></a><ul style='list-style: none;'><li><a href='#working_directory'>Working Directory</a></li><li><a href='#compiler_class_path'>Compiler Class Path</a></li><li><a href='#custom_template_loading'>Custom Template Loading</a></li><li><a href='#template_cache_configuration'>Template Cache Configuration</a></li></ul></li><li><a href='#other_resources'>Other Resources</a></li></ul></div>
<p>Scalate was designed to be easily embedded into your application or framework.</p>

<h2 id='creating_the_template_engine'>Creating the Template Engine</h2>

<p>The <code>TemplateEngine</code> class is your main way that you will be interfacing with Scalate. It is located in the <code>org.fusesource.scalate</code> package, you you might want to start off with that package import: <div class='syntax'><div class='highlight'><pre><span class='k'>import</span> <span class='nn'>org.fusesource.scalate._</span>&#x000A;</pre></div>&#x000A;</div></p>

<p>Once you create and configure and instance of <code>TemplateEngine</code>, it can be treated as a thread safe singleton. It has sensible configuration defaults so you could just use the following to compile and load a template: <div class='syntax'><div class='highlight'><pre><span class='k'>val</span> <span class='n'>engine</span> <span class='k'>=</span> <span class='k'>new</span> <span class='nc'>TemplateEngine</span>&#x000A;<span class='k'>val</span> <span class='n'>template</span> <span class='k'>=</span> <span class='n'>engine</span><span class='o'>.</span><span class='n'>load</span><span class='o'>(</span><span class='s'>&quot;/path/to/template.ssp&quot;</span><span class='o'>)</span>&#x000A;</pre></div>&#x000A;</div></p>

<p>The <code>load</code> method returns <code>Template</code> object. <code>Template</code> object is a dynamically byte code compiled version of the the requested template. The template engine caches the template for you and watches the original source files for updates so it pick up changes. Therefore, it&#8217;s recommended that you <code>load</code> the template each time you before you use it.</p>

<p>The next step is to render the template. To do this you first need to create a <code>RenderContext</code>. The <code>RenderContext</code> is used to supply the template with data collect the render results. <code>RenderContext</code> is just an interface in case you want to use a custom implementation, but the supplied <code>DefaultRenderContext</code> implementation should be suitable for most needs.</p>

<p>The following shows how to render loaded template: <div class='syntax'><div class='highlight'><pre><span class='k'>val</span> <span class='n'>buffer</span> <span class='k'>=</span> <span class='k'>new</span> <span class='nc'>StringWriter</span><span class='o'>()</span>&#x000A;<span class='k'>val</span> <span class='n'>context</span> <span class='k'>=</span> <span class='k'>new</span> <span class='nc'>DefaultRenderContext</span><span class='o'>(</span><span class='n'>engine</span><span class='o'>,</span> <span class='k'>new</span> <span class='nc'>PrintWriter</span><span class='o'>(</span><span class='n'>buffer</span><span class='o'>))</span>&#x000A;<span class='n'>template</span><span class='o'>.</span><span class='n'>render</span><span class='o'>(</span><span class='n'>context</span><span class='o'>)</span>&#x000A;<span class='n'>println</span><span class='o'>(</span><span class='n'>buffer</span><span class='o'>.</span><span class='n'>toString</span><span class='o'>)</span>&#x000A;</pre></div>&#x000A;</div></p>

<h2 id='passing_data_to_the_template'>Passing Data to the Template</h2>

<p>Variables can passed as attributes to the template via the render context. For example: <div class='syntax'><div class='highlight'><pre><span class='k'>val</span> <span class='n'>context</span> <span class='k'>=</span> <span class='k'>new</span> <span class='nc'>DefaultRenderContext</span><span class='o'>(</span><span class='n'>engine</span><span class='o'>,</span> <span class='k'>new</span> <span class='nc'>PrintWriter</span><span class='o'>(</span><span class='n'>buffer</span><span class='o'>))</span>&#x000A;<span class='n'>context</span><span class='o'>.</span><span class='n'>attributes</span><span class='o'>(</span><span class='s'>&quot;name&quot;</span><span class='o'>)</span> <span class='k'>=</span> <span class='o'>(</span><span class='s'>&quot;Hiram&quot;</span><span class='o'>,</span> <span class='s'>&quot;Chirino&quot;</span><span class='o'>)</span>&#x000A;<span class='n'>context</span><span class='o'>.</span><span class='n'>attributes</span><span class='o'>(</span><span class='s'>&quot;city&quot;</span><span class='o'>)</span> <span class='k'>=</span> <span class='s'>&quot;Tampa&quot;</span>&#x000A;<span class='n'>template</span><span class='o'>.</span><span class='n'>render</span><span class='o'>(</span><span class='n'>context</span><span class='o'>)</span>&#x000A;</pre></div>&#x000A;</div></p>

<p>A template can then access those attributes once they declare a variable binding. For example: <div class='syntax'><div class='highlight'><pre><span class='k'>&lt;%@</span> <span class='n'>var</span> <span class='nl'>name:</span><span class='o'>(</span><span class='n'>String</span><span class='o'>,</span><span class='n'>String</span><span class='o'>)</span> <span class='k'>%&gt;</span>&#x000A;<span class='k'>&lt;%@</span> <span class='n'>var</span> <span class='nl'>city:</span><span class='n'>String</span> <span class='k'>%&gt;</span>&#x000A;<span class='nt'>&lt;p&gt;</span> Hello ${name._1} ${name._2}, from ${city}. <span class='nt'>&lt;/p&gt;</span>&#x000A;</pre></div>&#x000A;</div></p>

<p>Would be rendered as: <div class='syntax'><div class='highlight'><pre><span class='nt'>&lt;p&gt;</span> Hello Hiram Chirino from Tampa. <span class='nt'>&lt;/p&gt;</span>&#x000A;</pre></div>&#x000A;</div></p>

<p>Each template syntax has it&#8217;s own way of declaring variable bindings. For more details on on how to declare variable bindings in your template please reference:</p>

<ul>
<li><a href='ssp-reference.html#binding_variables_'>Ssp Reference: Binding Variables</a></li>

<li><a href='scaml-reference.html#binding_variables_'>Scaml Reference: Binding Variables</a></li>
</ul>

<h2 id='passing_data_from_the_template_elsewhere'>Passing Data from the Template elsewhere</h2>

<p>If you wish you can export attributes from the template using the attributes on the context in a similar way as above.</p>

<p>For example inside a SSP page:</p>
<div class='syntax'><div class='highlight'><pre><span class='k'>&lt;%</span> <span class='n'>attributes</span><span class='o'>(</span><span class='s'>&quot;title&quot;</span><span class='o'>)</span> <span class='o'>=</span> <span class='s'>&quot;This is my new title&quot;</span> <span class='k'>%&gt;</span>&#x000A;<span class='nt'>&lt;p&gt;</span> This is some content. <span class='nt'>&lt;/p&gt;</span>&#x000A;</pre></div>&#x000A;</div>
<p>Now if the page is using layouts, the title attribute would be set on the page. i.e. this template outputs the title attribute so that it could be used by the layout.</p>

<h2 id='implicitly_bound_variables'>Implicitly Bound Variables</h2>

<p>Implicitly bound variables allow templates to access variables which they have not declared via a variable binding statement. For this to happen, the variable declaration is specified outside the template, when the template is compiled.</p>

<p>You can configure implicit variable bindings on the <code>TemplateEngine</code>. Every template compiled will then have variable declared. For example: <div class='syntax'><div class='highlight'><pre><span class='k'>val</span> <span class='n'>engine</span> <span class='k'>=</span> <span class='k'>new</span> <span class='nc'>TemplateEngine</span>&#x000A;<span class='n'>engine</span><span class='o'>.</span><span class='n'>bindings</span> <span class='k'>=</span> <span class='nc'>List</span><span class='o'>(</span><span class='nc'>Binding</span><span class='o'>(</span><span class='s'>&quot;name&quot;</span><span class='o'>,</span> <span class='s'>&quot;(String,String)&quot;</span><span class='o'>))</span>&#x000A;</pre></div>&#x000A;</div></p>

<p>You can also specify additional binding variables when you load the template: <div class='syntax'><div class='highlight'><pre><span class='k'>val</span> <span class='n'>template</span> <span class='k'>=</span> <span class='n'>engine</span><span class='o'>.</span><span class='n'>load</span><span class='o'>(</span><span class='s'>&quot;/path/to/template.ssp&quot;</span><span class='o'>,</span> <span class='nc'>List</span><span class='o'>(</span><span class='nc'>Binding</span><span class='o'>(</span><span class='s'>&quot;city&quot;</span><span class='o'>,</span> <span class='s'>&quot;String&quot;</span><span class='o'>)))</span>&#x000A;</pre></div>&#x000A;</div></p>

<p>In the above example, the <code>name</code> and <code>city</code> variables would be implicitly bound in the template. This means that previous example template would now need to omit the explicit variable declarations of <code>name</code> and <code>city</code>. The new template would look like: <div class='syntax'><div class='highlight'><pre><span class='nt'>&lt;p&gt;</span> Hello ${name._1} ${name._2}, from ${city}. <span class='nt'>&lt;/p&gt;</span>&#x000A;</pre></div>&#x000A;</div></p>

<h3 id='implicitly_imported_bound_variables'>Implicitly Imported Bound Variables</h3>

<p>When you configure an implicitly bound variable you choose to have the variable&#8217;s members imported into your templates name space. This is especially handy when you want to automatically expose helper methods to your template.</p>

<p>For example, lets say you want all templates to be able to use a method called <code>log</code>, then you could</p>

<ol>
<li>
<p>Define the Helper Class <div class='syntax'><div class='highlight'><pre><span class='k'>class</span> <span class='nc'>MyHelper</span> <span class='o'>{</span>&#x000A;  &#x000A;  <span class='k'>def</span> <span class='n'>log</span><span class='o'>(</span><span class='n'>message</span><span class='k'>:</span><span class='kt'>String</span><span class='o'>)</span> <span class='k'>=</span> <span class='o'>{</span>&#x000A;    <span class='o'>...</span>&#x000A;  <span class='o'>}</span>&#x000A;  &#x000A;<span class='o'>}</span>&#x000A;</pre></div>&#x000A;</div></p>
</li>

<li>
<p>Include it in the the implicit bindings. Setting the 3rd Binding parameter to true enables the member importing. <div class='syntax'><div class='highlight'><pre><span class='n'>engine</span><span class='o'>.</span><span class='n'>bindings</span> <span class='k'>=</span> <span class='nc'>List</span><span class='o'>(</span><span class='nc'>Binding</span><span class='o'>(</span><span class='s'>&quot;helper&quot;</span><span class='o'>,</span> <span class='s'>&quot;MyHelper&quot;</span><span class='o'>,</span> <span class='kc'>true</span><span class='o'>))</span>&#x000A;</pre></div>&#x000A;</div></p>
</li>

<li>
<p>Add an instance of the helper to the render context. <div class='syntax'><div class='highlight'><pre><span class='n'>context</span><span class='o'>.</span><span class='n'>attributes</span> <span class='o'>+=</span> <span class='s'>&quot;helper&quot;</span> <span class='o'>-&gt;</span> <span class='k'>new</span> <span class='nc'>MyHelper</span>&#x000A;</pre></div>&#x000A;</div></p>
</li>

<li>
<p>The method is now available for use in all templates: <div class='syntax'><div class='highlight'><pre><span class='nt'>&lt;p&gt;</span> Going to log something..<span class='nt'>&lt;/p&gt;</span>&#x000A;<span class='k'>&lt;%</span> <span class='n'>log</span><span class='o'>(</span><span class='s'>&quot;Our template just executed.&quot;</span><span class='o'>)</span> <span class='k'>%&gt;</span>&#x000A;</pre></div>&#x000A;</div></p>
</li>
</ol>

<p>The out of the box servlet integration that Scalate provides uses the above trick to give all rendered templates access to an imported &#8220;context&#8221; variable which is an instance of the <code>DefaultRenderContext</code> which is the same object which is collecting the render results. It provides the template a bunch of handy helper methods to do things like <code>capture</code> to get the result of rendering nested content or <code>filter</code> to apply a transformation filter to some content.</p>

<h2 id='configuring_the_'>Configuring the <code>TemplateEngine</code></h2>

<h3 id='working_directory'>Working Directory</h3>

<p>The template engine needs a working directory to generate scala code and java byte codes associated with the templates. By default, it use a location under your java temporary directory. You probably want to change this so that it uses data location configured for your application: <div class='syntax'><div class='highlight'><pre><span class='n'>engine</span><span class='o'>.</span><span class='n'>workingDirectory</span> <span class='k'>=</span> <span class='k'>new</span> <span class='nc'>File</span><span class='o'>(</span><span class='s'>&quot;/var/lib/myapp/work&quot;</span><span class='o'>)</span>&#x000A;</pre></div>&#x000A;</div></p>

<h3 id='compiler_class_path'>Compiler Class Path</h3>

<p>Scalate needs to know what class path to compile the templates against. By default it builds a class path using all the jars in the <code>ClassLoader</code> which loaded the Scalate jar. If you are in fancy mutli-<code>ClassLoader</code> application, like OSGi, they this simple heuristic will not work and you will need to specify the class path that the <code>TemplateEngine</code> should compile against. For example:</p>
<div class='syntax'><div class='highlight'><pre><span class='n'>engine</span><span class='o'>.</span><span class='n'>classpath</span> <span class='k'>=</span> <span class='s'>&quot;/path/to/lib.jar:/path/to/another-lib.jar&quot;</span>&#x000A;</pre></div>&#x000A;</div>
<h3 id='custom_template_loading'>Custom Template Loading</h3>

<p>In the default configuration, templates are loaded from the file system. The path you pass to the <code>TemplateEngine.load</code> method is expected to file path to an actual template file. If you want to load templates from different location, perhaps the classpath or database you will need to supply the <code>TemplateEngine</code> a custom implementation of <code>ResourceLoader</code>.</p>

<p>Here&#8217;s simple example that loads a dynamically generated template: <div class='syntax'><div class='highlight'><pre><span class='n'>engine</span><span class='o'>.</span><span class='n'>resourceLoader</span> <span class='k'>=</span> <span class='k'>new</span> <span class='nc'>FileResourceLoader</span> <span class='o'>{</span>&#x000A;    <span class='k'>override</span> <span class='k'>def</span> <span class='n'>load</span><span class='o'>(</span> <span class='n'>uri</span><span class='k'>:</span> <span class='kt'>String</span> <span class='o'>)</span><span class='k'>:</span> <span class='kt'>String</span> <span class='o'>=</span> &#x000A;        <span class='s'>&quot;&lt;%@ var name:String %&gt;&lt;p&gt;Hello ${name}&lt;/p&gt;&quot;</span>&#x000A;    <span class='k'>override</span> <span class='k'>def</span> <span class='n'>lastModified</span><span class='o'>(</span><span class='n'>uri</span><span class='k'>:</span><span class='kt'>String</span><span class='o'>)</span><span class='k'>:</span> <span class='kt'>Long</span> <span class='o'>=</span> <span class='mi'>0</span>&#x000A;<span class='o'>}</span>&#x000A;</pre></div>&#x000A;</div></p>

<h3 id='template_cache_configuration'>Template Cache Configuration</h3>

<p>If you are running in production it may make sense to disable template reloading.<br />It should be slightly quicker as it avoids doing file system checks for template modifications: <div class='syntax'><div class='highlight'><pre><span class='n'>engine</span><span class='o'>.</span><span class='n'>allowReload</span> <span class='k'>=</span>  <span class='kc'>false</span>&#x000A;</pre></div>&#x000A;</div></p>

<p>If you have a large number of templates and would rather not cache them in as compiled java classes in memory, you can disable template caching altogether with: <div class='syntax'><div class='highlight'><pre><span class='n'>engine</span><span class='o'>.</span><span class='n'>allowCaching</span> <span class='k'>=</span>  <span class='kc'>false</span>&#x000A;</pre></div>&#x000A;</div></p>
<!--
TODO: Cover adding CodeGenerator and Filter extensions.
-->
<h2 id='other_resources'>Other Resources</h2>

<ul>
<li><a href='user-guide.html'>User Guide</a></li>

<li><a href='index.html'>Documentation</a></li>
</ul>
  	</div>
  </div>





<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-1347593-12");
pageTracker._trackPageview();
} catch(err) {}
</script>
</body>
</html>